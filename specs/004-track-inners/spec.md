# Feature Specification: Просмотр внутреннего содержимого трека

**Feature Branch**: `004-track-inners`
**Created**: 2026-02-18
**Status**: Draft
**Input**: User description: "004-track-inners"

## User Scenarios & Testing *(mandatory)*

### User Story 1 — Просмотр полного содержимого трека (Priority: P1)

Исследователь открывает страницу сгенерированного трека и видит всё содержимое
curriculum-а: компетенции, KSA-матрицу, учебные единицы с задачами PBL — в читаемом
структурированном формате, а не в виде сырого JSON. Это позволяет быстро оценить
качество сгенерированного курса без технических знаний о структуре данных.
Пользователь просматривает расписание занятий трека в соответствующей вкладке - это нужно,
чтобы оценить корректность генерации расписания.

**Why this priority**: Без читаемого отображения контента трека невозможно оценить
качество работы алгоритма — основная цель инструмента.

**Independent Test**: Открыть любой completed-трек и убедиться, что компетенции,
KSA-матрица и PBL-задачи отображаются без необходимости читать raw JSON.

**Acceptance Scenarios**:

1. **Given** трек со статусом completed, **When** открываю страницу трека,
   **Then** вижу список компетенций с названиями и описаниями (из шага B2).
2. **Given** трек с заполненной KSA-матрицей (B3), **When** перехожу в соответствующий
   раздел, **Then** вижу для каждой компетенции разбивку на Знания, Умения, Навыки.
3. **Given** трек с PBL-задачами (B6), **When** открываю раздел задач,
   **Then** каждая задача отображается с формулировкой проблемы и ожидаемым результатом.
4. **Given** трек, у которого шаг B6 не выполнялся, **When** открываю раздел PBL,
   **Then** вижу понятное сообщение «Задачи не сгенерированы» вместо пустого блока.

---

### User Story 2 — Навигация между разделами пайплайна (Priority: P2)

Исследователь может быстро переключаться между выходами разных шагов (B2–B7),
чтобы сфокусироваться на конкретном аспекте сгенерированного курса.

**Why this priority**: При анализе качества трека нужно сравнивать выходы разных
шагов — без удобной навигации исследователь теряет время.

**Independent Test**: Открыть трек и последовательно перейти во все разделы
(Компетенции, KSA, Учебные единицы, PBL-задачи, Расписание) без ошибок.

**Acceptance Scenarios**:

1. **Given** страница трека, **When** переключаюсь между разделами,
   **Then** переход происходит мгновенно без перезагрузки страницы.
2. **Given** активный раздел с длинным списком (>20 элементов), **When** прокручиваю,
   **Then** навигация между разделами остаётся доступной (фиксированные табы).

---

### User Story 3 — Просмотр дерева учебных единиц с деталями (Priority: P2)

Исследователь видит иерархическое дерево учебных единиц (блоки, темы, подтемы)
с указанием типа каждого элемента (theory, practice, automation) и длительностью.
Позволяет оценить баланс и структуру курса.

Исследователь видит расписание занятий учебного курса, где недели с контрольными
точками (checkpoint) визуально выделены.

**Why this priority**: Дерево уже частично реализовано, но требует показа деталей
каждой единицы (тип, длительность). Checkpoint-недели из расписания помогают оценить
точки контроля прогресса.

**Independent Test**: Открыть дерево курса и убедиться, что у каждого узла видны
тип и длительность. В разделе расписания — недели с checkpoint'ами визуально выделены.

**Acceptance Scenarios**:

1. **Given** трек с learning_units (B4/B5), **When** открываю «Дерево курса»,
   **Then** вижу узлы с типом (theory/practice/automation) и длительностью в минутах.
2. **Given** узел дерева, **When** разворачиваю его, **Then** вижу дочерние элементы
   и их детали без перезагрузки.
3. **Given** трек с расписанием (B7), **When** открываю раздел «Расписание»,
   **Then** недели, содержащие checkpoint, визуально выделены относительно обычных недель.

---

### User Story 4 — Быстрый переход к треку со страницы профиля (Priority: P3)

Исследователь, находясь на странице детального просмотра профиля, может одним
кликом открыть последний сгенерированный трек для этого профиля.

**Why this priority**: Удобство рабочего процесса — не нужно идти через страницу
списка треков для доступа к результату генерации.

**Independent Test**: Открыть профиль, для которого есть хотя бы один трек, и
убедиться в наличии рабочей ссылки на трек.

**Acceptance Scenarios**:

1. **Given** профиль с completed-треком, **When** открываю страницу профиля,
   **Then** вижу ссылку на последний трек этого профиля.
2. **Given** профиль без треков, **When** открываю страницу профиля,
   **Then** ссылки на трек нет, есть кнопка «Генерировать трек».

---

### Edge Cases

- Трек со статусом `failed` или `cancelled`: страница открывается, незаполненные
  разделы показывают понятное сообщение об ошибке или отсутствии данных.
- Трек в статусе `generating`: разделы отображают данные только завершённых шагов,
  остальные показывают «В процессе генерации».
- Список с >50 учебными единицами: дерево/список прокручивается без потери
  производительности интерфейса.
- Поля с null/undefined значениями внутри track_data: не вызывают ошибок рендеринга,
  показывают «—» или пропускаются.
- Компетенция без KSA-элементов: показывается сама компетенция, раздел KSA
  показывает «Не заполнено».

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: Страница трека MUST отображать выход шага B2 (компетенции) в виде
  читаемого списка с названием и описанием каждой компетенции.
- **FR-002**: Страница трека MUST отображать выход шага B3 (KSA-матрица) сгруппированно
  по компетенциям: для каждой компетенции из B2 — связанные с ней элементы знаний
  (`knowledge_items`), умений (`skill_items`) и навыков/привычек (`habit_items`),
  отфильтрованные по `related_competency_ids`. Группировка выполняется на клиенте.
- **FR-003**: Страница трека MUST отображать выход шага B6 (PBL-задачи) — список
  задач с формулировкой проблемы и контекстом решения.
- **FR-004**: Дерево учебных единиц (B4/B5) MUST показывать тип (theory/practice/automation)
  и длительность в минутах каждого элемента.
- **FR-005**: В разделе расписания (B7) недели с контрольными точками (`schedule.checkpoints`)
  MUST быть визуально выделены относительно обычных учебных недель.
- **FR-006**: Все разделы MUST обрабатывать отсутствующие или null данные без
  ошибок рендеринга — показывать информативное сообщение-заглушку.
- **FR-007**: Страница трека MUST показывать статус каждого шага B1–B8
  (завершён / не выполнен / ошибка) в разделе метаданных.
- **FR-008**: Страница профиля MUST отображать ссылку на последний трек профиля,
  если трек существует.

### Key Entities

- **PersonalizedTrack**: Сгенерированный учебный трек. Содержит `track_data`
  (JSON со всеми выходами B1–B8), `status`, `generation_metadata`, `validation_b8`.
- **CompetencySet**: Набор компетенций из шага B2. Атрибуты каждой компетенции:
  идентификатор, название, описание.
- **KSAMatrix**: KSA-матрица из шага B3. Плоские списки `knowledge_items` (Знания),
  `skill_items` (Умения), `habit_items` (Навыки), сгруппированные в UI по компетенциям
  через `related_competency_ids`.
- **LearningUnit**: Учебная единица из B4/B5. Атрибуты: идентификатор, название,
  тип (theory/practice/automation), длительность в минутах, родительский элемент (кластер).
- **PBLProblem**: Задача PBL из шага B6. Атрибуты: формулировка проблемы, контекст,
  связанные компетенции или учебные единицы.

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: Исследователь может найти и прочитать любой конкретный элемент
  сгенерированного контента (компетенцию, KSA-элемент, задачу PBL) менее чем за
  30 секунд после открытия страницы трека.
- **SC-002**: Все выходы шагов B2, B3, B6 имеют визуальное представление
  на странице трека — ни один из них не требует чтения raw JSON для понимания.
- **SC-003**: Страница трека открывается без JS-ошибок для 100% треков любого
  статуса (completed, failed, cancelled, generating).
- **SC-004**: Переключение между разделами трека занимает менее 0.5 секунды
  (без сетевых запросов при переключении).

## Clarifications

### Session 2026-02-18

- Q: Что должно быть визуально выделено как «checkpoint» — тип unit'а в дереве B4/B5 или нечто в расписании? → A: Checkpoint'ы из `schedule.checkpoints` (B7) выделяются в разделе расписания; в дереве B4/B5 типы unit'ов — только theory/practice/automation, без отдельного выделения.
- Q: Как организовать отображение ЗУН-матрицы — по компетенциям или плоскими списками? → A: Группировать по компетенциям (из B2), клиентская группировка через `related_competency_ids` каждого K/S/H элемента.
- Q: Как называть `habit_items` в UI — «Навыки», «Привычки» или «Автоматизм»? → A: «Навыки» — соответствует аббревиатуре ЗУН (Знания-Умения-Навыки).

## Assumptions *(include if important)*

- Структура `track_data` JSON содержит поля для B2 (`competency_set`), B3
  (`ksa_matrix`), B6 (`lesson_blueprints`).
- Компоненты `TreeView`, `WeeklySchedule`, `TrackMetadata` заменены новыми реализациями;
  добавлены компоненты `CompetencyList`, `KSAMatrix`, `LessonBlueprints`, `EmptySection`, `TrackTabs`.
- Страница детального просмотра профиля существует или будет создана минимально
  в рамках этой фичи только для добавления ссылки на трек (US4).
- Данные для всех разделов берутся из уже загруженного `track_data` — дополнительных
  API-запросов при переключении табов не требуется.
