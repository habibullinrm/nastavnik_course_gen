# Feature Specification: Manual Mode

**Feature Branch**: `003-manual-profile`
**Created**: 2026-02-18
**Status**: Draft
**Input**: TBD


**Цель**
Реализовать ручной режим создания файла профиля или редактирования существующего файла профиля в браузере.

**Функции**
1. форма в браузере
2. логика заполнения и поля/переменные должны соотвествовать @docs/phase_a.md
3. кнопка выгрузки профиля — скачивает готовый JSON-файл профиля в браузере
4. при загрузке файла профиля для редактирования файл проходит валидацию, значения подставляются в соответствующие поля
5. Обязательная отметь уровень значимости переменных, уровни прописаны в phase_a.md
6. можно выбрать файл профиля из БД из сохраненных профилей
7. /Стандартный путь пользователя такой: выбирает профиль или создает новый/редактирует существующий -> попадает на страницу /tracks/generate?profile_id= и выбирает генерацию трека(пакетная или одиночная) или отладка -> переходит в соответсвующий режим

**Инструменты**
1. для тестирования визуальной части используй mcp__playwright
2. После каждого этапа тасков проводи тесты

## Clarifications

### Session 2026-02-18

- Q: При выборе профиля из БД на `/profiles/new` и нажатии «Сохранить» — создаётся новый профиль или обновляется оригинал? → A: Всегда создаётся новый профиль (`POST /form`). Выбор из БД только заполняет форму; сохранение всегда создаёт новую запись.
- Q: При загрузке JSON-файла в уже частично заполненную форму — полная перезапись или слияние? → A: Полная перезапись. Все поля формы заменяются данными из файла без диалога подтверждения.
- Q: Что показывать при ошибке сохранения (сеть, 422, 500)? → A: Inline-блок ошибки над кнопкой «Сохранить» (красный текст с описанием), форма остаётся заполненной.
- Q: Как пользователь попадает на `/tracks/generate?profile_id=` после сохранения? → A: Автоматический редирект сразу после успешного ответа `201` от backend. Кнопок перехода в форме нет.
- Q: Что делает кнопка «Пакетная генерация» на `/tracks/generate`? → A: Кнопка не реализуется. Страница `/tracks/generate` содержит только два действия: «Сгенерировать трек» (выбрать опцию - одиночная или batch, → запускает пайплайн генерации) и «Отладка» (→ `/manual`).
- Q: Страница `/tracks/generate` уже существует с функционалом single/batch режима. Задача T030 — создать заново или обновить существующую? → A: Обновить существующую страницу — добавить ссылку «Отладка» (→ `/manual`) рядом с существующими элементами управления. Весь текущий функционал (выбор режима, batch-размер, прогресс) сохраняется.
- Q: Куда ведёт «Отладка» из `/tracks/generate?profile_id=X` — на `/manual` или `/manual?profile_id=X`? → A: Ссылка ведёт на `/manual?profile_id=X`. Страница `/manual` читает `profile_id` из query и предзаполняет поле выбора профиля в форме создания новой сессии.