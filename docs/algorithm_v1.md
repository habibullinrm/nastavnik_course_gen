# ИТОГОВЫЙ АЛГОРИТМ ГЕНЕРАЦИИ ПЕРСОНАЛИЗИРОВАННОГО УЧЕБНОГО КУРСА

## Архитектура системы

Система состоит из **3 фаз**, **8 блоков** и **~35 шагов**.

```
ФАЗА A: СБОР ДАННЫХ (Блоки 1-5) ─── Диалог с пользователем
    │
ФАЗА B: ПРОЕКТИРОВАНИЕ (Блоки 6-7) ─── Генерация курса системой
    │
ФАЗА C: ОБУЧЕНИЕ (Блок 8) ─── Проблемно-ориентированное проведение занятий
```

---

## ФАЗА A: СБОР ДАННЫХ И ПРОФИЛИРОВАНИЕ

> Цель: получить от пользователя структурированные ответы для построения профиля.
> Формат: пошаговый диалог — система задаёт вопросы, пользователь отвечает.

---

### БЛОК 1. Контекст и мотивация

---

#### Шаг 1.1 — Идентификация роли и уровня

| Параметр | Значение |
|---|---|
| **Название** | `identify_role_and_level` |
| **Что делает система** | Запрашивает у пользователя его текущую роль, уровень опыта и наличие формального обучения по теме. |
| **Вопросы пользователю** | 1. «Какую профессиональную роль вы сейчас выполняете?» 2. «Какой у вас опыт в этой (или смежной) области? (начинающий / с опытом / эксперт)» 3. «Есть ли у вас опыт формального обучения по этой теме?» |
| **Пример ответа** | «Я студент технического вуза, 2 курс. Начинающий. Логику не изучал, на первом курсе была краткая вводная лекция, но многого не понял. Изучал только в рамках университетского курса "Дискретная математика", но отстаю от группы.» |
| **Извлекаемые данные** | `role`: string (например, "студент технического вуза, 2 курс"); `experience_level`: enum [beginner, intermediate, expert]; `formal_education`: string (описание предыдущего обучения); `identified_risks`: string[] (например, ["пробелы в базовых концепциях", "отставание от группы"]) |

---

#### Шаг 1.2 — Выявление мотивации

| Параметр | Значение |
|---|---|
| **Название** | `identify_motivation` |
| **Что делает система** | Запрашивает ключевую мотивацию для определения типа целей (внешняя/внутренняя) и приоритетов. |
| **Вопрос пользователю** | «Какова ваша ключевая мотивация для освоения этого навыка/компетенции? (карьерный рост, решение конкретной рабочей задачи, личный интерес, смена профессии и т.д.)» |
| **Пример ответа** | «Сдать экзамен по дискретной математике на 4 или 5. Также хочу разобраться в основах, потому что логика нужна для будущих предметов — теории алгоритмов и программирования.» |
| **Извлекаемые данные** | `motivation_external`: string (например, "сдать экзамен на 4-5"); `motivation_internal`: string (например, "понимание основ для будущих предметов"); `goal_type`: enum [applied, fundamental, mixed] |

---

#### Шаг 1.3 — Образ результата

| Параметр | Значение |
|---|---|
| **Название** | `identify_desired_outcome` |
| **Что делает система** | Запрашивает описание идеального результата обучения — что пользователь сможет делать иначе/лучше. |
| **Вопрос пользователю** | «Опишите в идеале, как будет выглядеть ваша деятельность после успешного освоения этого навыка. Что вы сможете делать иначе/лучше?» |
| **Пример ответа** | «Смогу самостоятельно решать типовые задачи на таблицы истинности, упрощать логические выражения, строить отрицания для утверждений с кванторами. На экзамене буду уверенно выполнять эти задания без паники.» |
| **Извлекаемые данные** | `desired_outcomes`: string[] — список конкретных действий, которые пользователь хочет уметь; `target_context`: string (например, "экзамен, уверенное выполнение без паники") |

---

### БЛОК 2. Учебные задачи (Компонент 1 модели 4C/ID)

---

#### Шаг 2.1 — Сбор типичных задач

| Параметр | Значение |
|---|---|
| **Название** | `collect_target_tasks` |
| **Что делает система** | Запрашивает 2-3 конкретные задачи, которые пользователь хочет научиться выполнять. Задачи должны быть максимально конкретными. |
| **Вопрос пользователю** | «Опишите подробно 2-3 самые типичные и важные задачи, которые вы хотите научиться выполнять. Например, не "изучить маркетинг", а "составить план запуска нового продукта для малого бизнеса".» |
| **Пример ответа** | «1) Строить таблицы истинности для сложных формул с импликацией и эквивалентностью. 2) Доказывать логические законы (типа де Моргана) через таблицы. 3) Правильно строить отрицания для высказываний с кванторами "для всех" и "существует".» |
| **Извлекаемые данные** | `target_tasks`: Task[] — массив объектов {id, description, complexity_rank} |

---

#### Шаг 2.2 — Ранжирование задач по сложности

| Параметр | Значение |
|---|---|
| **Название** | `rank_tasks` |
| **Что делает система** | Просит пользователя указать самую простую задачу (точка старта) и самую сложную ("вершину мастерства"). |
| **Вопрос пользователю** | «Проранжируйте эти задачи: какая кажется вам самой простой/доступной для старта? Какая — самой сложной и комплексной, ваша "вершина мастерства"?» |
| **Пример ответа** | «Самая простая — таблицы истинности для простых формул (И, ИЛИ, НЕ). Самая сложная — построение отрицаний для утверждений с вложенными кванторами, например: ¬(∀x ∃y: P(x,y)).» |
| **Извлекаемые данные** | `easiest_task_id`: ref → Task; `hardest_task_id`: ref → Task (это "вершина мастерства" — ключевая интегральная цель обучения); `task_hierarchy`: Task[] — упорядоченный массив от простого к сложному |

---

#### Шаг 2.3 — Декомпозиция сложной задачи

| Параметр | Значение |
|---|---|
| **Название** | `decompose_hardest_task` |
| **Что делает система** | Просит пользователя описать подзадачи самой сложной задачи. Это даёт материал для формирования умений и навыков. |
| **Вопрос пользователю** | «Можете ли вы описать подзадачи, из которых состоит самая сложная задача?» |
| **Пример ответа** | «1. Определить структуру утверждения: где кванторы, как связаны. 2. Понимать правило: ¬∀ = ∃¬ и ¬∃ = ∀¬. 3. Последовательно "спускать" отрицание внутрь, меняя кванторы. 4. Упрощать получившееся выражение.» |
| **Извлекаемые данные** | `subtasks`: Subtask[] — массив {id, description, parent_task_id, required_knowledge[], required_skills[]}. Каждая подзадача станет основой для конкретного умения (У) в матрице ЗУН. |

---

#### Шаг 2.4 — Контекст применения

| Параметр | Значение |
|---|---|
| **Название** | `identify_application_context` |
| **Что делает система** | Определяет, где именно пользователь будет применять навык (работа, учёба, личные проекты). Это влияет на формат задач и примеров. |
| **Вопрос пользователю** | «В каком контексте вы будете применять этот навык? Например, реальные рабочие проекты, учебные симуляции, личные проекты.» |
| **Пример ответа** | «В основном для решения учебных задач на экзамене, но также хочу формализовывать простые утверждения на практике (при анализе условий в программировании).» |
| **Извлекаемые данные** | `primary_context`: string (например, "академический, экзамен"); `secondary_context`: string (например, "программирование, анализ условий"); `context_type`: enum [academic, professional, personal, mixed] |

---

### БЛОК 3. Диагностика понимания и предпочтений (Компонент 2 — Поддерживающая информация)

---

#### Шаг 3.1 — Диагностика текущего подхода

| Параметр | Значение |
|---|---|
| **Название** | `diagnose_current_approach` |
| **Что делает система** | Даёт пользователю пример простой учебной задачи из его предметной области и просит описать, как он её решает сейчас. Это выявляет текущую ментальную модель и пробелы. |
| **Вопрос пользователю** | «Опишите, как вы в настоящее время подходите к решению задачи [пример простой задачи из темы]. Какие шаги предпринимаете и на что опираетесь?» |
| **Примечание** | Система формирует пример задачи на основе `easiest_task_id` из шага 2.2. |
| **Пример ответа** | «Пытаюсь вспомнить таблицу для импликации, часто путаю, когда она ложная. Потом делаю столбец для ¬B, потом пытаюсь соединить. Часто ошибаюсь на шаге с ∧.» |
| **Извлекаемые данные** | `current_approach`: string — описание текущей стратегии; `approach_gaps`: string[] — конкретные ошибки и пробелы в текущем подходе (например, ["путает таблицу импликации", "ошибки на конъюнкции"]) |

---

#### Шаг 3.2 — Выявление трудностей

| Параметр | Значение |
|---|---|
| **Название** | `identify_difficulties` |
| **Что делает система** | Запрашивает трудности при выполнении сложной задачи. Выявляет концептуальные барьеры, требующие теоретического объяснения. |
| **Вопрос пользователю** | «С какими самыми большими трудностями или неопределённостями вы сталкиваетесь, когда пытаетесь выполнить [сложная задача из шага 2.2]?» |
| **Пример ответа** | «Не понимаю, как "переворачивать" кванторы при отрицании. Запутался в разнице между ∀ и ∃ в комбинациях.» |
| **Извлекаемые данные** | `key_barriers`: Barrier[] — массив {id, description, related_task_id, barrier_type: enum [conceptual, procedural, motivational]} |

---

#### Шаг 3.3 — Выявление путаницы в терминах

| Параметр | Значение |
|---|---|
| **Название** | `identify_confusing_concepts` |
| **Что делает система** | Выявляет конкретные термины и концепции, которые вызывают путаницу. Эти данные напрямую формируют блок «Знания» в матрице ЗУН. |
| **Вопрос пользователю** | «Какие ключевые термины или концепции в этой области вызывают у вас наибольшую путаницу или кажутся "размытыми"?» |
| **Пример ответа** | «Импликация (⇒) — почему она истинна, когда посылка ложна? Эквивалентность (⇔) — чем отличается от импликации? Кванторы — как их читать в сложных формулах?» |
| **Извлекаемые данные** | `confusing_concepts`: Concept[] — массив {id, term, confusion_description}. Каждый элемент станет обязательной темой в теоретическом блоке. |

---

#### Шаг 3.4 — Предпочтения по формату теории

| Параметр | Значение |
|---|---|
| **Название** | `identify_theory_preferences` |
| **Что делает система** | Определяет предпочитаемый формат подачи теоретического материала. |
| **Вопросы пользователю** | 1. «Как вы предпочитаете усваивать новую сложную информацию? (примеры из практики / теоретические модели и схемы / видео / обсуждения с экспертами)» 2. «Приведите пример самого полезного теоретического материала, который вы когда-либо изучали. Что именно в его подаче сделало его понятным?» |
| **Пример ответа** | «Через наглядные схемы и таблицы. Правило на примере, потом алгоритм действий. Помогли конспекты-шпаргалки по алгебре, где все формулы были собраны в одну схему с примерами.» |
| **Извлекаемые данные** | `theory_format_preference`: enum [visual_schemas, examples_first, video, discussion, mixed]; `theory_format_details`: string (описание идеального формата); `best_material_reference`: string (что именно было полезно — для калибровки стиля подачи) |

---

### БЛОК 4. Предпочтения по практике (Компоненты 3-4 модели 4C/ID)

---

#### Шаг 4.1 — Формат инструкций

| Параметр | Значение |
|---|---|
| **Название** | `identify_instruction_preferences` |
| **Что делает система** | Определяет предпочтительный формат процедурных инструкций для практических заданий. |
| **Вопрос пользователю** | «Как вам удобнее получать инструкции для выполнения практических заданий: пошаговые чек-листы, видеоинструкции, интерактивные симуляции, справочные карточки?» |
| **Пример ответа** | «Пошаговые чек-листы с примерами. Видеоинструкции на 2-3 минуты.» |
| **Извлекаемые данные** | `instruction_format`: string[] (например, ["checklist", "short_video"]) |

---

#### Шаг 4.2 — Формат обратной связи и отработки

| Параметр | Значение |
|---|---|
| **Название** | `identify_feedback_preferences` |
| **Что делает система** | Определяет предпочтения по типу обратной связи и формату тренировки навыка. |
| **Вопросы пользователю** | 1. «Для отработки практического навыка вам было бы полезнее: мгновенная автоматическая проверка / сравнение с эталонным образцом / готовый шаблон-"рыба"?» 2. «Какой тип обратной связи наиболее продуктивен: немедленная сигнализация об ошибке / детальный разбор в конце / визуализация прогресса?» |
| **Пример ответа** | «Сравнение с эталоном + готовый шаблон. Немедленная сигнализация об ошибке + краткое объяснение, почему ошибка.» |
| **Извлекаемые данные** | `practice_format`: string[] (например, ["compare_with_standard", "template"]); `feedback_type`: string[] (например, ["immediate_error_signal", "brief_explanation"]) |

---

#### Шаг 4.3 — Режим автоматизации (микро-тренировки)

| Параметр | Значение |
|---|---|
| **Название** | `identify_automation_mode` |
| **Что делает система** | Определяет готовность к ежедневным коротким тренировкам и доступные «окна» в расписании. |
| **Вопросы пользователю** | 1. «Сколько минут в день вы готовы уделить коротким ежедневным упражнениям для автоматизации навыка?» 2. «Можете ли вы выделить 2-3 коротких "окна" (по 10-15 минут), где вы могли бы закрепить навык?» |
| **Пример ответа** | «10-15 минут ежедневно, обязательно с напоминанием. Утром за завтраком и вечером перед сном — на телефоне.» |
| **Извлекаемые данные** | `daily_practice_minutes`: int; `practice_windows`: PracticeWindow[] — массив {time_of_day, duration_minutes, device}; `needs_reminder`: bool |

---

#### Шаг 4.4 — Критерии освоения навыка и поддержка

| Параметр | Значение |
|---|---|
| **Название** | `identify_mastery_signals` |
| **Что делает система** | Определяет, как пользователь субъективно поймёт, что навык отработан, и какая минимальная поддержка нужна для регулярных тренировок. |
| **Вопросы пользователю** | 1. «Как вы поймёте в своей реальной работе/учёбе, что навык отработан хорошо и начал работать на вас?» 2. «Какая минимальная поддержка или "напоминалка" помогла бы вам внедрить короткие тренировки?» |
| **Пример ответа** | «Перестану путать кванторы. Смогу быстро строить отрицания без шпаргалок. Нужно: календарное напоминание + шаблон для быстрого решения одной микро-задачи.» |
| **Извлекаемые данные** | `mastery_signals`: string[] — субъективные маркеры освоения; `support_tools`: string[] (например, ["calendar_reminder", "solution_template"]) |

---

### БЛОК 5. Организационные ограничения

---

#### Шаг 5.1 — Временной бюджет

| Параметр | Значение |
|---|---|
| **Название** | `identify_time_budget` |
| **Что делает система** | Определяет общий бюджет времени и его распределение по дням недели. |
| **Вопрос пользователю** | «Какой у вас еженедельный лимит времени на обучение? Как он обычно распределён (например, 2 часа каждый вечер или 1 день на выходных)?» |
| **Пример ответа** | «5 часов в неделю: 2 часа в субботу, 1 час в воскресенье, и по 30-40 минут в будние дни вечером.» |
| **Извлекаемые данные** | `weekly_hours`: float; `schedule`: Schedule[] — массив {day_of_week, available_minutes}. Эти данные будут использоваться для расчёта длительности трека и распределения контента по неделям. |

---

#### Шаг 5.2 — Формат обучения

| Параметр | Значение |
|---|---|
| **Название** | `identify_learning_format` |
| **Что делает система** | Определяет предпочитаемый формат обучения и уровень сопровождения. |
| **Вопрос пользователю** | «В каком формате вы видите обучение? (самостоятельно по материалам / с консультациями ментора / в группе / смешанный формат)» |
| **Пример ответа** | «Самостоятельно по материалам, но с возможностью задать вопрос преподавателю в чате. Групповые занятия не люблю.» |
| **Извлекаемые данные** | `learning_format`: enum [self_paced, mentored, group, blended]; `support_channel`: string (например, "чат с куратором") |

---

#### Шаг 5.3 — Критерии успеха

| Параметр | Значение |
|---|---|
| **Название** | `identify_success_criteria` |
| **Что делает система** | Определяет измеримые критерии успешного завершения обучения. Они станут KPI трека. |
| **Вопрос пользователю** | «Как мы поймём, что обучение прошло успешно? Какие будут критерии успеха? (защита проекта, сдача экзамена, выполнение рабочей задачи и т.д.)» |
| **Пример ответа** | «1) Сдам экзамен на 4 или 5. 2) На пробном экзамене решу ≥80% задач без ошибок. 3) Смогу объяснить другому студенту, как строить отрицания с кванторами.» |
| **Извлекаемые данные** | `success_criteria`: Criterion[] — массив {id, description, measurable: bool, metric: string}. Пример: {description: "Решить ≥80% задач на пробнике", measurable: true, metric: "accuracy >= 0.8"} |

---

## ФАЗА B: ПРОЕКТИРОВАНИЕ КУРСА

> Цель: на основе собранного профиля автоматически сгенерировать структуру персонализированного трека.
> Формат: система выполняет все шаги самостоятельно, без вопросов к пользователю.

---

### БЛОК 6. Формирование профиля и компетенций

---

#### Шаг 6.1 — Сборка профиля обучающегося

| Параметр | Значение |
|---|---|
| **Название** | `build_student_profile` |
| **Что делает система** | Агрегирует все извлечённые данные из фазы A в единый структурированный профиль. |
| **Вход** | Все данные из шагов 1.1–5.3. |
| **Алгоритм** | 1. Определить `level` (beginner/intermediate/expert) из шага 1.1. 2. Определить `goal_type` (applied/fundamental/mixed) из шагов 1.2-1.3. 3. Собрать `task_hierarchy` из шагов 2.1-2.4. 4. Собрать `barriers` из шагов 3.1-3.3. 5. Собрать `preferences` из шагов 3.4, 4.1-4.4. 6. Собрать `constraints` из шагов 5.1-5.3. |
| **Выход** | `StudentProfile` — единый объект, содержащий все поля. |

**Структура `StudentProfile`:**

```
StudentProfile {
  // Идентификация
  role: string
  experience_level: enum
  formal_education: string
  identified_risks: string[]

  // Мотивация и цели
  motivation_external: string
  motivation_internal: string
  goal_type: enum
  desired_outcomes: string[]
  target_context: string

  // Учебные задачи
  target_tasks: Task[]
  task_hierarchy: Task[]  // от простого к сложному
  peak_task: Task  // "вершина мастерства"
  subtasks: Subtask[]
  application_context: string

  // Барьеры и пробелы
  current_approach: string
  approach_gaps: string[]
  key_barriers: Barrier[]
  confusing_concepts: Concept[]

  // Предпочтения
  theory_format_preference: enum
  theory_format_details: string
  instruction_format: string[]
  practice_format: string[]
  feedback_type: string[]
  daily_practice_minutes: int
  practice_windows: PracticeWindow[]
  needs_reminder: bool
  mastery_signals: string[]
  support_tools: string[]

  // Ограничения
  weekly_hours: float
  schedule: Schedule[]
  learning_format: enum
  support_channel: string
  success_criteria: Criterion[]
}
```

---

#### Шаг 6.2 — Формулирование целевых компетенций

| Параметр | Значение |
|---|---|
| **Название** | `formulate_competencies` |
| **Что делает система** | На основе иерархии задач формулирует 2-5 целевых компетенций в формате: «Способен [действие] в условиях [контекст]». |
| **Вход** | `profile.task_hierarchy`, `profile.peak_task`, `profile.subtasks`, `profile.application_context` |
| **Алгоритм** | 1. Взять `peak_task` как интегральную цель — она даёт главную компетенцию. 2. Для каждой группы задач из `task_hierarchy` сформулировать отдельную компетенцию. 3. Компетенция = свёрнутый ответ на вопрос «Что я буду уметь после обучения?». 4. Формат: «Способен [глагол + объект] в условиях [контекст из profile.application_context]». |
| **Выход** | `competencies`: Competency[] — массив {id, description, source_tasks: Task[], level: enum [basic, intermediate, advanced]} |

**Пример выхода:**

```
К1: "Способен применять аппарат булевой алгебры для анализа 
     и преобразования логических выражений" (basic)
К2: "Способен формализовывать высказывания с использованием кванторов 
     и выполнять логические операции над ними" (advanced)
К3: "Способен анализировать истинность сложных логических утверждений 
     на конкретных множествах" (intermediate)
```

---

#### Шаг 6.3 — Декомпозиция компетенций на ЗУН

| Параметр | Значение |
|---|---|
| **Название** | `decompose_to_ksa` |
| **Что делает система** | Раскладывает каждую компетенцию на конкретные Знания (З), Умения (У) и Навыки (Н) — матрицу ЗУН. |
| **Вход** | `competencies`, `profile.confusing_concepts`, `profile.key_barriers`, `profile.subtasks`, `profile.mastery_signals`, `profile.success_criteria` |
| **Алгоритм** | Для каждой компетенции: 1. **Знания (З)**: извлечь из `confusing_concepts` + `key_barriers` — «какую теорию надо знать, чтобы преодолеть барьер». Формат: «Знать [определение/правило/закон]». 2. **Умения (У)**: извлечь из `subtasks` + `task_hierarchy` — «какие сознательные действия надо уметь выполнять». Формат: «Уметь [действие с объектом]». 3. **Навыки (Н)**: извлечь из `mastery_signals` + `success_criteria` — «что должно быть доведено до автоматизма». Формат: «Навык [автоматическое действие]». |
| **Выход** | `ksa_matrix`: KSA_Matrix — словарь {competency_id -> {knowledge: Knowledge[], skills: Skill[], habits: Habit[]}} |

**Пример выхода для К1:**

```
К1 -> {
  knowledge: [
    З1: "Знать таблицы истинности для НЕ, И, ИЛИ, ИМПЛИКАЦИЯ, ЭКВИВАЛЕНТНОСТЬ",
    З2: "Знать основные законы логики (де Моргана, дистрибутивность)"
  ],
  skills: [
    У1: "Уметь строить таблицы истинности для составных высказываний",
    У2: "Уметь доказывать логические тождества с помощью таблиц"
  ],
  habits: [
    Н1: "Навык быстрого определения истинности простых формул",
    Н2: "Навык аккуратного заполнения таблиц истинности"
  ]
}
```

---

### БЛОК 7. Проектирование содержания и структуры трека

---

#### Шаг 7.1 — Генерация тем и учебных единиц

| Параметр | Значение |
|---|---|
| **Название** | `generate_learning_units` |
| **Что делает система** | Превращает каждый элемент ЗУН в конкретную учебную единицу (тему, задание, упражнение). |
| **Вход** | `ksa_matrix`, `profile.theory_format_preference`, `profile.instruction_format`, `profile.feedback_type` |
| **Алгоритм** | 1. **Из Знаний -> Темы для теории**: для каждого З создать тему в предпочитаемом формате. Привязать к формату из `theory_format_preference`. 2. **Из Умений -> Задания для практики**: для каждого У создать тренажёр/задание с процедурными инструкциями в формате из `instruction_format`. 3. **Из Навыков -> Упражнения для автоматизации**: для каждого Н создать микро-упражнение для ежедневной тренировки в формате из `feedback_type`. |
| **Выход** | `learning_units`: LearningUnit[] — массив {id, type: enum [theory, practice, automation], title, description, source_ksa_ids, format, estimated_minutes} |

**Маппинг на модель 4C/ID:**

| Элемент ЗУН | Компонент 4C/ID | Тип учебной единицы |
|---|---|---|
| Знания (З) | Поддерживающая информация | Теория (конспект, схема, видео) |
| Умения (У) | Процедурная информация | Тренажёр с пошаговой обратной связью |
| Навыки (Н) | Частичная практика | Микро-упражнение на скорость |

---

#### Шаг 7.2 — Построение иерархии по уровням сложности

| Параметр | Значение |
|---|---|
| **Название** | `build_difficulty_hierarchy` |
| **Что делает система** | Распределяет учебные единицы по уровням сложности и устанавливает зависимости. |
| **Вход** | `learning_units`, `profile.task_hierarchy`, `profile.key_barriers`, `profile.weekly_hours` |
| **Алгоритм** | Для каждой учебной единицы определить уровень по 4 критериям (в порядке приоритета): 1. **Логическая зависимость** (обязательно): нельзя изучать тему B, если она требует знания темы A. Строим DAG (направленный ациклический граф) зависимостей. 2. **Диагностированная сложность**: темы из `key_barriers` получают больше времени и размещаются после тщательной подготовки. 3. **Целевой контекст**: действия, критически важные для KPI (экзамен), выносятся в фокус продвинутого уровня. 4. **Временные рамки**: объём контента <= `weekly_hours` x количество недель. |
| **Выход** | `levels`: Level[] — массив {level: enum [basic, intermediate, advanced, integration], units: LearningUnit[], prerequisites: LearningUnit[]} |

---

#### Шаг 7.3 — Сборка персонализированного трека

| Параметр | Значение |
|---|---|
| **Название** | `assemble_track` |
| **Что делает система** | Собирает все компоненты в финальный учебный план с понедельным расписанием. |
| **Вход** | `levels`, `learning_units`, `profile.schedule`, `profile.weekly_hours`, `profile.support_tools`, `profile.success_criteria` |
| **Алгоритм** | 1. **Рассчитать длительность трека**: total_hours = сумма estimated_minutes всех units / 60. Weeks = ceil(total_hours / weekly_hours). 2. **Распределить по неделям**: от простого к сложному вдоль иерархии. Каждая неделя содержит цикл: Теория -> Практика -> Автоматизация. 3. **Встроить поддержку**: напоминания, шаблоны, доступ к ментору — из `support_tools`. 4. **Последняя неделя — интеграция**: пробный экзамен / итоговое задание, привязанное к `success_criteria`. 5. **Для каждой недели**: сформировать список занятий с привязкой к дням из `schedule`. |
| **Выход** | `Track` — финальная структура |

**Структура `Track`:**

```
Track {
  title: string
  total_weeks: int
  total_hours: float
  competencies: Competency[]
  ksa_matrix: KSA_Matrix

  weeks: Week[] {
    week_number: int
    level: enum [basic, intermediate, advanced, integration]
    theme: string
    learning_goal: string
    
    sessions: Session[] {
      day_of_week: string
      duration_minutes: int
      type: enum [theory, practice, automation]
      units: LearningUnit[]
    }

    daily_exercises: DailyExercise[] {
      description: string
      duration_minutes: int
      time_of_day: string
    }

    week_kpi: string  // что студент должен уметь к концу недели
    support_tools: string[]
  }

  final_assessment: {
    type: string  // "пробный экзамен", "проект" и т.д.
    success_threshold: string  // ">=80% правильных решений"
    linked_criteria: Criterion[]
  }
}
```

---

## ФАЗА C: ПРОВЕДЕНИЕ ОБУЧЕНИЯ (ПРОБЛЕМНО-ОРИЕНТИРОВАННЫЙ ПОДХОД)

> Цель: провести студента через каждую тему трека с использованием проблемно-ориентированных учебных действий.
> Формат: интерактивный диалог «система <-> студент» по каждой теме.

---

### БЛОК 8. Движок проведения занятий (конечный автомат)

> Этот блок реализует цикл обучения для каждой учебной единицы из трека.
> Система работает как конечный автомат (Finite State Machine) с 8 состояниями.

---

#### Шаг 8.0 — Инициализация занятия

| Параметр | Значение |
|---|---|
| **Название** | `init_lesson` |
| **Что делает система** | Загружает текущую учебную единицу из трека, определяет начальное состояние. |
| **Вход** | Текущая `LearningUnit` из `Track.weeks[i].sessions[j]` |
| **Выход** | `lesson_state`: {current_state: "PP", unit: LearningUnit, attempt_count: 0, hints_used: 0, history: []} |
| **Следующий шаг** | Всегда -> Шаг 8.1 (ПП) |

---

#### Шаг 8.1 — Практическая проблема (ПП)

| Параметр | Значение |
|---|---|
| **Название** | `present_problem` |
| **Код состояния** | `PP` |
| **Что делает система** | Формулирует проблему на основе текущей учебной единицы. Проблема может быть в форме: проблемной постановки («не хватает...»), проблемного вопроса («что нужно для...?»), конкретной аутентичной задачи («найди..., реши...»), кейса (описание реальной ситуации). Формат выбирается исходя из `unit.type` и `profile.theory_format_preference`. |
| **Сообщение пользователю** | Контекстная задача, привязанная к реальности студента. Пример: «Представьте, друг говорит: "Если я получу премию, то куплю тебе кофе". В каких ситуациях он сдержит слово, а в каких — солжёт?» |
| **Ожидаемые типы ответа** | см. таблицу переходов ниже |

**Таблица переходов из ПП:**

| Ответ ученика | Следующее состояние | Логика |
|---|---|---|
| Выдвигает >=1 гипотезу (даже неверную) | -> ГП (8.2) | Фиксируем гипотезы |
| Молчит / "не знаю" | -> ПЗ (8.8) -> возврат к ПП или ГП | Стимулирующая подсказка |
| Задаёт уточняющие вопросы | -> КИ (8.3) | Точечная теория |
| Сразу предлагает решение | -> ПТ (8.5) | Усложняем противоречием |

---

#### Шаг 8.2 — Гипотезы (ГП)

| Параметр | Значение |
|---|---|
| **Название** | `collect_hypotheses` |
| **Код состояния** | `GP` |
| **Что делает система** | Анализирует гипотезы ученика: оценивает текущий уровень понимания, выявляет пробелы и фокусы. |
| **Сообщение пользователю** | «Интересно! Расскажите подробнее, как вы к этому пришли?» (или аналогичное поощрение к развёртыванию гипотез) |

**Таблица переходов из ГП:**

| Ответ ученика | Следующее состояние | Логика |
|---|---|---|
| Есть явный пробел (незнание ключевого факта) | -> КИ (8.3) | Даём недостающую теорию |
| Нет пробелов, но решение поверхностно | -> ПТ (8.5) | Углубляем противоречием |
| Несколько конкурирующих идей | -> ПМ (8.4) | Проверить каждую микрозаданием |
| Все гипотезы ошибочны, но ученик уверен | -> ПТ (8.5) | Показать противоречие |
| Ученик сам просит информации | -> КИ (8.3) | Даём теорию |

---

#### Шаг 8.3 — Ключевая информация / Теория (КИ)

| Параметр | Значение |
|---|---|
| **Название** | `provide_key_information` |
| **Код состояния** | `KI` |
| **Что делает система** | Даёт ТОЧЕЧНУЮ теорию — только ту, которой не хватает для проверки гипотезы или решения проблемы. Не «вот вся теория», а «вот ключ, которого не хватало». Формат — из `profile.theory_format_preference`. |
| **Сообщение пользователю** | Конкретное объяснение с примером в предпочитаемом формате. Пример: «Таблица истинности для импликации: A => B ложна ТОЛЬКО когда A истинно, а B ложно. Как обман обещания — вы обещали, но не сделали.» |

**Таблица переходов из КИ:**

| Контекст | Следующее состояние | Логика |
|---|---|---|
| Первая порция КИ по теме | -> ПМ (8.4) | Немедленное применение |
| Вторая/третья порция КИ | -> ГП (8.2) | Как изменились гипотезы? |
| Ученик проявил интерес к смежной теме | -> ПТ (8.5) | Расширяем контекст |
| Ученик пассивен после КИ | -> ПМ (8.4) | Обязательное применение |

---

#### Шаг 8.4 — Применение (ПМ)

| Параметр | Значение |
|---|---|
| **Название** | `apply_knowledge` |
| **Код состояния** | `PM` |
| **Что делает система** | Даёт практическое задание, где нужно применить полученную КИ. Задание — маленький шаг в решении общей проблемы. |
| **Сообщение пользователю** | Конкретное задание. Пример: «Определите истинность: (2*2=4) => (3*3=9); (2*2=5) => (3*3=10).» |

**Таблица переходов из ПМ:**

| Результат | Следующее состояние | Логика |
|---|---|---|
| Успешно + проблема почти решена | -> СЗ (8.6) | Переход к синтезу |
| Успешно + проблема сложная | -> ПТ (8.5) | Углубляем |
| Неуспешно из-за непонимания | -> КИ (8.3) | Другой аспект теории |
| Неуспешно из-за невнимательности | -> ПЗ (8.8) | Наводящий вопрос |
| Неуспешно, но ученик понимает почему | -> ГП (8.2) | Новые гипотезы |

---

#### Шаг 8.5 — Противоречие (ПТ)

| Параметр | Значение |
|---|---|
| **Название** | `present_contradiction` |
| **Код состояния** | `PT` |
| **Что делает система** | Намеренно показывает ограниченность текущего решения, ставит в тупик более сложным случаем или задаёт каверзный вопрос. |
| **Сообщение пользователю** | Пример: «А теперь проверьте: (A => B) <=> (not A or B). Всегда ли это верно? Постройте таблицы для обеих частей.» |

**Таблица переходов из ПТ:**

| Реакция | Следующее состояние | Логика |
|---|---|---|
| Интеллектуальный интерес, попытка разрешить | -> ГП (8.2) | Новые гипотезы |
| Растерянность, фрустрация | -> ПЗ (8.8) -> КИ (8.3) | Поддержка + теория |
| Игнорирование противоречия | -> ПТ (8.5) | Усилить конфликт |
| Успешное разрешение | -> СЗ (8.6) | Итоговый синтез |
| Частичное разрешение | -> ПМ (8.4) | Проверить новое понимание |

---

#### Шаг 8.6 — Синтез (СЗ)

| Параметр | Значение |
|---|---|
| **Название** | `synthesize` |
| **Код состояния** | `SZ` |
| **Что делает система** | Просит ученика собрать все открытия в единый ответ на исходную проблему (ПП). |
| **Сообщение пользователю** | «Теперь соберите воедино всё, что мы разобрали. Сформулируйте полное решение исходной задачи.» |

**Таблица переходов из СЗ:**

| Результат | Следующее состояние | Логика |
|---|---|---|
| Полный и логичный ответ | -> РФ (8.7) | Рефлексия |
| Неполный, но ученик осознаёт пробелы | -> ПЗ (8.8) | Подсказка |
| Неполный без осознания | -> ПТ (8.5) | Показать последствия |
| Ошибочный | -> КИ (8.3) | Вернуться к теории |
| Формальный, без глубины | -> РФ (8.7) | Рефлексия углубит |

---

#### Шаг 8.7 — Рефлексия (РФ)

| Параметр | Значение |
|---|---|
| **Название** | `reflect` |
| **Код состояния** | `RF` |
| **Что делает система** | Задаёт вопросы не «что ты узнал?», а «как ты пришёл к решению?», «какой шаг был самым трудным?». Формирует мета-навык. |
| **Сообщения пользователю** | 1. «Какой шаг был самым сложным и почему?» 2. «Почему [метод] — надёжный способ проверки?» 3. «Где в жизни/работе вы встречаете подобные ситуации?» |

**Таблица переходов из РФ:**

| Результат | Следующее состояние | Логика |
|---|---|---|
| Глубокая рефлексия с инсайтами | -> Новая ПП (8.1) следующей темы | Переход к новой теме |
| Поверхностная рефлексия | -> ПТ (8.5) | Противоречие о процессе |
| Отсутствует рефлексия | -> ПЗ (8.8) | Подсказка |
| Только эмоциональная | -> ГП (8.2) | Как использовать этот опыт? |

---

#### Шаг 8.8 — Подсказка (ПЗ)

| Параметр | Значение |
|---|---|
| **Название** | `provide_hint` |
| **Код состояния** | `PZ` |
| **Что делает система** | Даёт наводящий вопрос, отсылку к уже известному опыту или предложение взглянуть под другим углом. НЕ даёт прямой ответ. |
| **Сообщение пользователю** | Пример: «Вспомните, что значит "обмануть обещание"? Когда вы почувствуете, что вас обманули?» |

**Таблица переходов из ПЗ:**

| Реакция | Следующее состояние | Логика |
|---|---|---|
| Ученик активизировался | -> Возврат к предыдущему состоянию | Продолжаем |
| Ученик остался пассивен | -> ПЗ (8.8) другого типа | Другой угол |
| Ученик просит ещё помощи | -> КИ (8.3) | Даём теорию |
| Ученик злится/сопротивляется | -> ПТ (8.5) | Обсуждаем сопротивление |

---

## СВОДНАЯ ДИАГРАММА СОСТОЯНИЙ БЛОКА 8

```
                    +-------------------------------------+
                    |          INIT (8.0)                  |
                    +----------------+--------------------+
                                     | всегда
                                     v
                    +-------------------------------------+
         +--------->|          ПП (8.1)                   |<----- из РФ (новая тема)
         |          |   Практическая проблема              |
         |          +---+------+------+------+------------+
         |              |      |      |      |
         |       гипотеза  не знаю  вопрос  решение
         |              |      |      |      |
         |              v      v      v      v
         |          +------+ +----+ +----+ +----+
         |          | ГП   | | ПЗ | | КИ | | ПТ |
         |          |(8.2) | |8.8 | |8.3 | |8.5 |
         |          +--+---+ +--+-+ +-+--+ +-+--+
         |             |       |     |      |
         |             v       |     v      |
         |      +----------+   |  +------+  |
         |      | КИ / ПТ  |   |  | ПМ   |  |
         |      | / ПМ     |   |  |(8.4) |  |
         |      +----+-----+   |  +--+---+  |
         |           |         |     |      |
         |           v         |     v      |
         |        +------+    |  +------+   |
         |        | ПМ   |----+  | СЗ   |<--+
         |        |(8.4) |       |(8.6) |
         |        +--+---+      +--+---+
         |           |              |
         |           +-------+------+
         |                   v
         |             +----------+
         |             |  РФ      |
         |             |  (8.7)   |
         |             +----+-----+
         |                  |
         |        глубокая  |  поверхностная
         |                  |
         +------------------+
```

---

## СВОДКА: МАППИНГ ШАГОВ НА ПРОГРАММНЫЕ МОДУЛИ

| Фаза | Блок | Шаги | Тип модуля | Описание |
|---|---|---|---|---|
| A | 1-5 | 1.1-5.3 | `DataCollector` | Диалоговый сборщик данных (14 шагов с вопросами) |
| B | 6 | 6.1-6.3 | `ProfileBuilder` | Агрегация профиля + формулирование компетенций + ЗУН |
| B | 7 | 7.1-7.3 | `TrackGenerator` | Генерация учебных единиц + иерархия + сборка трека |
| C | 8 | 8.0-8.8 | `LessonEngine` | Конечный автомат проведения занятий (8 состояний) |

---

## ПРИЛОЖЕНИЕ A: ПОЛНАЯ ТАБЛИЦА ПЕРЕХОДОВ СОСТОЯНИЙ (для реализации FSM)

| Текущее | Ответ ученика | Следующее | Действие системы |
|---------|--------------------------------------|-----------|-------------------------------------|
| ПП | гипотеза | ГП | фиксируем все гипотезы |
| ПП | не знаю / молчит | ПЗ->ПП/ГП | стимулирующая подсказка |
| ПП | уточняющий вопрос | КИ | точечная теория |
| ПП | готовое решение | ПТ | усложняем противоречием |
| ГП | есть пробел | КИ | даём недостающий факт |
| ГП | поверхностно | ПТ | углубляем |
| ГП | несколько идей | ПМ | проверяем каждую |
| ГП | всё ошибочно, но уверен | ПТ | показываем противоречие |
| ГП | просит информации | КИ | даём теорию |
| КИ | первая порция | ПМ | немедленное применение |
| КИ | вторая+ порция | ГП | как изменились гипотезы? |
| КИ | интерес к смежному | ПТ | расширяем контекст |
| КИ | пассивен | ПМ | обязательное применение |
| ПМ | успех + проблема почти решена | СЗ | синтез |
| ПМ | успех + проблема сложная | ПТ | углубляем |
| ПМ | неуспех: непонимание | КИ | другой аспект теории |
| ПМ | неуспех: невнимательность | ПЗ | наводящий вопрос |
| ПМ | неуспех, но понимает почему | ГП | новые гипотезы |
| ПТ | интерес | ГП | новые гипотезы |
| ПТ | растерянность | ПЗ->КИ | поддержка + теория |
| ПТ | игнорирование | ПТ | усилить конфликт |
| ПТ | успешное разрешение | СЗ | итоговый синтез |
| ПТ | частичное разрешение | ПМ | проверить новое понимание |
| СЗ | полный и логичный | РФ | рефлексия |
| СЗ | неполный, осознаёт | ПЗ | подсказка |
| СЗ | неполный, не осознаёт | ПТ | показать последствия |
| СЗ | ошибочный | КИ | вернуться к теории |
| СЗ | формальный | РФ | рефлексия углубит |
| РФ | глубокая | ПП(new) | следующая тема |
| РФ | поверхностная | ПТ | противоречие о процессе |
| РФ | отсутствует | ПЗ | подсказка к рефлексии |
| РФ | только эмоциональная | ГП | как использовать опыт? |
| ПЗ | активизировался | <-prev | возврат к предыдущему |
| ПЗ | пассивен | ПЗ(alt) | другой угол |
| ПЗ | просит помощи | КИ | конкретная теория |
| ПЗ | злится | ПТ | обсуждаем сопротивление |

---

## ПРИЛОЖЕНИЕ B: КЛЮЧЕВЫЕ ТИПЫ ДАННЫХ (TypeScript)

```typescript
// ============================================================
// ФАЗА A: Входные данные (сбор от пользователя)
// ============================================================

interface Task {
  id: string;
  description: string;
  complexity_rank: number; // 1 = самая простая
}

interface Subtask {
  id: string;
  description: string;
  parent_task_id: string;
  required_knowledge: string[];
  required_skills: string[];
}

interface Barrier {
  id: string;
  description: string;
  related_task_id: string;
  barrier_type: 'conceptual' | 'procedural' | 'motivational';
}

interface Concept {
  id: string;
  term: string;
  confusion_description: string;
}

interface PracticeWindow {
  time_of_day: string;       // "morning", "evening"
  duration_minutes: number;
  device: string;            // "phone", "computer"
}

interface Schedule {
  day_of_week: string;       // "monday", "saturday" ...
  available_minutes: number;
}

interface Criterion {
  id: string;
  description: string;
  measurable: boolean;
  metric: string;            // "accuracy >= 0.8"
}

// ============================================================
// ФАЗА A: Агрегированный профиль
// ============================================================

interface StudentProfile {
  // Шаг 1.1
  role: string;
  experience_level: 'beginner' | 'intermediate' | 'expert';
  formal_education: string;
  identified_risks: string[];

  // Шаг 1.2
  motivation_external: string;
  motivation_internal: string;
  goal_type: 'applied' | 'fundamental' | 'mixed';

  // Шаг 1.3
  desired_outcomes: string[];
  target_context: string;

  // Шаги 2.1-2.4
  target_tasks: Task[];
  task_hierarchy: Task[];
  peak_task: Task;
  subtasks: Subtask[];
  primary_context: string;
  secondary_context: string;
  context_type: 'academic' | 'professional' | 'personal' | 'mixed';

  // Шаги 3.1-3.3
  current_approach: string;
  approach_gaps: string[];
  key_barriers: Barrier[];
  confusing_concepts: Concept[];

  // Шаги 3.4, 4.1-4.4
  theory_format_preference: 'visual_schemas' | 'examples_first' | 'video' | 'discussion' | 'mixed';
  theory_format_details: string;
  best_material_reference: string;
  instruction_format: string[];
  practice_format: string[];
  feedback_type: string[];
  daily_practice_minutes: number;
  practice_windows: PracticeWindow[];
  needs_reminder: boolean;
  mastery_signals: string[];
  support_tools: string[];

  // Шаги 5.1-5.3
  weekly_hours: number;
  schedule: Schedule[];
  learning_format: 'self_paced' | 'mentored' | 'group' | 'blended';
  support_channel: string;
  success_criteria: Criterion[];
}

// ============================================================
// ФАЗА B: Генерация курса
// ============================================================

interface Competency {
  id: string;
  description: string;      // "Способен [действие] в условиях [контекст]"
  source_tasks: Task[];
  level: 'basic' | 'intermediate' | 'advanced';
}

interface KSA_Entry {
  id: string;
  type: 'knowledge' | 'skill' | 'habit';
  description: string;
  competency_id: string;
}

type KSA_Matrix = Record<string, {
  knowledge: KSA_Entry[];
  skills: KSA_Entry[];
  habits: KSA_Entry[];
}>;

interface LearningUnit {
  id: string;
  type: 'theory' | 'practice' | 'automation';
  title: string;
  description: string;
  content: string;           // сгенерированный контент учебной единицы
  source_ksa_ids: string[];
  format: string;            // "visual_schema", "checklist", "micro_exercise"
  estimated_minutes: number;
  level: 'basic' | 'intermediate' | 'advanced';
  prerequisites: string[];   // id других LearningUnit
}

interface DailyExercise {
  description: string;
  duration_minutes: number;
  time_of_day: string;
}

interface Session {
  day_of_week: string;
  duration_minutes: number;
  type: 'theory' | 'practice' | 'automation';
  units: LearningUnit[];
}

interface Week {
  week_number: number;
  level: 'basic' | 'intermediate' | 'advanced' | 'integration';
  theme: string;
  learning_goal: string;
  sessions: Session[];
  daily_exercises: DailyExercise[];
  week_kpi: string;
  support_tools: string[];
}

interface Track {
  title: string;
  total_weeks: number;
  total_hours: number;
  competencies: Competency[];
  ksa_matrix: KSA_Matrix;
  weeks: Week[];
  final_assessment: {
    type: string;
    success_threshold: string;
    linked_criteria: Criterion[];
  };
}

// ============================================================
// ФАЗА C: Конечный автомат занятий (Lesson Engine)
// ============================================================

type LessonState = 'PP' | 'GP' | 'KI' | 'PM' | 'PT' | 'SZ' | 'RF' | 'PZ';

type StudentResponseType =
  // Из ПП
  | 'hypothesis' | 'dont_know' | 'clarification_question' | 'ready_solution'
  // Из ГП
  | 'has_gap' | 'superficial' | 'multiple_ideas' | 'wrong_but_confident' | 'asks_for_info'
  // Из КИ
  | 'first_portion' | 'subsequent_portion' | 'interest_in_related' | 'passive'
  // Из ПМ
  | 'success_almost_done' | 'success_complex' | 'fail_misunderstanding'
  | 'fail_carelessness' | 'fail_but_understands_why'
  // Из ПТ
  | 'intellectual_interest' | 'confusion' | 'ignoring' | 'resolved' | 'partial_resolution'
  // Из СЗ
  | 'complete_logical' | 'incomplete_aware' | 'incomplete_unaware' | 'erroneous' | 'formal'
  // Из РФ
  | 'deep_reflection' | 'shallow_reflection' | 'no_reflection' | 'emotional_only'
  // Из ПЗ
  | 'activated' | 'still_passive' | 'asks_more_help' | 'frustrated';

interface Transition {
  from_state: LessonState;
  response_type: StudentResponseType;
  to_state: LessonState;
  system_action: string;
}

interface LessonHistoryEntry {
  state: LessonState;
  student_input: string;
  system_output: string;
  response_type: StudentResponseType;
  timestamp: string;
}

interface LessonContext {
  current_state: LessonState;
  previous_state: LessonState | null;
  unit: LearningUnit;
  problem_statement: string;
  hypotheses: string[];
  ki_portions_given: number;
  attempt_count: number;
  hints_used: number;
  history: LessonHistoryEntry[];
}

// ============================================================
// Основной контроллер - интерфейс модулей
// ============================================================

interface DataCollector {
  /** Фаза A: последовательно задаёт вопросы и собирает ответы */
  runInterview(): Promise<StudentProfile>;
}

interface ProfileBuilder {
  /** Шаг 6.1: агрегация профиля */
  buildProfile(rawData: StudentProfile): StudentProfile;
  /** Шаг 6.2: формулирование компетенций */
  formulateCompetencies(profile: StudentProfile): Competency[];
  /** Шаг 6.3: декомпозиция на ЗУН */
  decomposeToKSA(competencies: Competency[], profile: StudentProfile): KSA_Matrix;
}

interface TrackGenerator {
  /** Шаг 7.1: генерация учебных единиц */
  generateUnits(ksa: KSA_Matrix, profile: StudentProfile): LearningUnit[];
  /** Шаг 7.2: построение иерархии */
  buildHierarchy(units: LearningUnit[], profile: StudentProfile): Level[];
  /** Шаг 7.3: сборка трека */
  assembleTrack(levels: Level[], units: LearningUnit[], profile: StudentProfile): Track;
}

interface LessonEngine {
  /** Шаг 8.0: инициализация */
  initLesson(unit: LearningUnit): LessonContext;
  /** Классификация ответа ученика */
  classifyResponse(context: LessonContext, response: string): StudentResponseType;
  /** Определение следующего состояния по таблице переходов */
  getNextState(context: LessonContext, responseType: StudentResponseType): LessonState;
  /** Генерация сообщения системы для текущего состояния */
  generateMessage(context: LessonContext): string;
  /** Основной цикл занятия */
  runLesson(unit: LearningUnit): Promise<void>;
}
```

---

## ПРИЛОЖЕНИЕ C: ПОРЯДОК ВЫЗОВА МОДУЛЕЙ (PIPELINE)

```
1. DataCollector.runInterview()
   -> StudentProfile (сырые данные)

2. ProfileBuilder.buildProfile(rawData)
   -> StudentProfile (агрегированный)

3. ProfileBuilder.formulateCompetencies(profile)
   -> Competency[]

4. ProfileBuilder.decomposeToKSA(competencies, profile)
   -> KSA_Matrix

5. TrackGenerator.generateUnits(ksa, profile)
   -> LearningUnit[]

6. TrackGenerator.buildHierarchy(units, profile)
   -> Level[]

7. TrackGenerator.assembleTrack(levels, units, profile)
   -> Track

8. FOR EACH week IN Track.weeks:
     FOR EACH session IN week.sessions:
       FOR EACH unit IN session.units:
         LessonEngine.initLesson(unit)
         LessonEngine.runLesson(unit)  // интерактивный цикл FSM
```
